{"mappings":"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","sources":["<anon>","src/main.ts","src/modules/Webshop.ts","src/modules/RestApi.ts","src/modules/ShoppingCart.ts","src/modules/utilities.ts"],"sourcesContent":["/*\r\n    Dummy Webshop - Inlämningsuppgift 3 - Javascript 2 - FE23\r\n    By Kristoffer Bengtsson\r\n\r\n    main.js\r\n    Main script of the fake webshop page. Initialization and interface event handlers. \r\n*/ /*\r\n    Dummy Webshop - Inlämningsuppgift 3 - Javascript 2 - FE23\r\n    By Kristoffer Bengtsson\r\n\r\n    Webshop.js\r\n    Main class of the fake webshop. Fetch and display products. \r\n*/ /*\r\n    Dummy Webshop - Inlämningsuppgift 3 - Javascript 2 - FE23\r\n    By Kristoffer Bengtsson\r\n\r\n    RestApi.js\r\n    Generic class for making requests to a REST API using JSON data. \r\n*/ class $6b2c46a57cbfd4b0$export$2e2bcd8739ae039 {\n    constructor(baseUrl, urlSuffix = \"\"){\n        this.urlBase = baseUrl;\n        this.urlSuffix = urlSuffix;\n        this.lastRequest = {\n            url: null,\n            method: \"None\",\n            options: undefined\n        };\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\n    // Send GET request to API\n    async getJson(urlPath = \"\", queryParams = null) {\n        const response = await fetch(this.buildRequestUrl(urlPath, queryParams));\n        const result = await response.json();\n        if (!response.ok) this.handleResponseErrors(response, result);\n        this.lastRequest.method = \"GET\";\n        this.lastRequest.options = undefined;\n        return result;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\n    // Send POST request to API\n    async postJson(urlPath = \"\", formData = null, queryParams = null) {\n        let response = await fetch(this.buildRequestUrl(urlPath, queryParams), this.getFetchOptions(\"POST\", formData ?? {}));\n        let result = await response.json();\n        if (!response.ok) this.handleResponseErrors(response, result);\n        this.lastRequest.method = \"POST\";\n        return result;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\n    // Send PATCH request to API\n    async updateJson(urlPath = \"\", formData = null, queryParams = null) {\n        let response = await fetch(this.buildRequestUrl(urlPath, queryParams), this.getFetchOptions(\"PATCH\", formData ?? {}));\n        let result = await response.json();\n        if (!response.ok) this.handleResponseErrors(response, result);\n        this.lastRequest.method = \"PATCH\";\n        return result;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\n    // Send DELETE request to API\n    async deleteJson(urlPath = \"\", formData = null, queryParams = null) {\n        let response = await fetch(this.buildRequestUrl(urlPath, queryParams), this.getFetchOptions(\"DELETE\", formData ?? {}));\n        let result = await response.json();\n        if (!response.ok) this.handleResponseErrors(response, result);\n        this.lastRequest.method = \"DELETE\";\n        return result;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\n    // Repeat latest request, with optional modifications.\n    // If urlPath or queryParams is set they will override that existing value of the last request. \n    async repeatRequestJson(urlPath = \"\", queryParams = null) {\n        const response = await fetch(this.rebuildRequestUrl(urlPath, queryParams), this.lastRequest.options ?? {});\n        const result = await response.json();\n        if (!response.ok) this.handleResponseErrors(response, result);\n        return result;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\n    // Create a json-encoded object from a FormData object\n    formdataToJson(formData) {\n        var dataObject = {};\n        if (formData instanceof FormData) formData.forEach((value, key)=>{\n            // In case the remote api is type sensitive (like Firebase), convert to numbers and booleans from the FormData strings \n            let currValue = value;\n            if (!isNaN(Number(value))) currValue = Number(value);\n            else if (value === \"true\" || value === \"false\") currValue = value === \"true\";\n            // Handle formdata with multiple value fields with the same name attribute (like SELECT tags \n            //  with the \"multiple\" attribute, checkbox groups etc)\n            if (!(key in dataObject)) dataObject[key] = currValue;\n            else {\n                if (!Array.isArray(dataObject[key])) dataObject[key] = [\n                    dataObject[key]\n                ];\n                dataObject[key].push(currValue);\n            }\n        });\n        return JSON.stringify(dataObject);\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\n    // Assemble URL to send requests to.\n    buildRequestUrl(urlPath = \"\", queryParams = null) {\n        const url = new URL(`${this.urlBase}${urlPath.length ? \"/\" + urlPath : \"\"}${this.urlSuffix}`);\n        if (queryParams && Object.keys(queryParams).length > 0) for(const key in queryParams){\n            if (Array.isArray(queryParams[key])) for (const elem of queryParams[key])url.searchParams.append(key, elem);\n            else url.searchParams.append(key, queryParams[key]);\n        }\n        this.lastRequest.url = url;\n        return url;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\n    // Get and update last requested URL. \n    rebuildRequestUrl(urlPath = \"\", queryParams = null) {\n        if (!this.lastRequest.url) this.lastRequest.url = this.buildRequestUrl(urlPath, queryParams);\n        else {\n            if (urlPath.length > 0) this.lastRequest.url.pathname = `/${urlPath}${this.urlSuffix}`;\n            // Set additional query params, or override existing with same name. \n            if (queryParams && Object.keys(queryParams).length > 0) {\n                for(const key in queryParams)if (Array.isArray(queryParams[key]) && queryParams[key].length > 0) {\n                    this.lastRequest.url.searchParams.set(key, queryParams[key][0]);\n                    for(let i = 1; i < queryParams[key].length; i++)this.lastRequest.url.searchParams.append(key, queryParams[key][i]);\n                } else this.lastRequest.url.searchParams.set(key, queryParams[key]);\n            }\n        }\n        return this.lastRequest.url;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\n    // Build options object for fetch() for submitting JSON data.\n    getFetchOptions(reqMethod, formData) {\n        const options = {\n            method: reqMethod,\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: formData instanceof FormData ? this.formdataToJson(formData) : JSON.stringify(formData)\n        };\n        this.lastRequest.options = options;\n        return options;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\n    // Handle error responses from the API requests\n    handleResponseErrors(response, result) {\n        this.lastRequest.url = null;\n        this.lastRequest.method = \"None\";\n        this.lastRequest.options = undefined;\n        if (response.status == 400) throw new $6b2c46a57cbfd4b0$export$f2e832acab1bdd79(response.status, `Bad request: ${result.error ?? \"\"}  (${response.statusText})`);\n        else if (response.status == 500) throw new $6b2c46a57cbfd4b0$export$f2e832acab1bdd79(response.status, `Server error: ${result.error ?? \"\"}  (${response.statusText})`);\n        else throw new $6b2c46a57cbfd4b0$export$f2e832acab1bdd79(response.status, `API Error: ${response.statusText}`);\n    }\n}\nclass $6b2c46a57cbfd4b0$export$f2e832acab1bdd79 extends Error {\n    constructor(errorCode, errorMessage){\n        super(errorMessage);\n        this.errorCode = errorCode;\n    }\n}\n\n\n/*\r\n    Dummy Webshop - Inlämningsuppgift 3 - Javascript 2 - FE23\r\n    By Kristoffer Bengtsson\r\n\r\n    ShoppingCart.js\r\n    Class for managing the shopping cart, managing products the user is \"buying\".\r\n*/ /*\r\n    Dummy Webshop - Inlämningsuppgift 3 - Javascript 2 - FE23\r\n    By Kristoffer Bengtsson\r\n\r\n    utilities.js\r\n    My general utility functions module (trimmed down to only what is used here)\r\n*/ ///////////////////////////////////////////////////////////////////////////////\n// Create and return (or attach) a HTML element based on a template.\n//  - templateId is the ID of the <template> tag in the HTML file to use.\n//  - container is the parent element to insert the new element into.\n//  - values is an object where the key is a classname and value is the value\n//    to set as innerText/HTML of the matching element within the new object\n//    (or href for links, src for images, value for form fields)\n//  - attributes is an object where the key is the name of existing attributes\n//    on tags in the template to set the value of. \nfunction $0cde2d9f4d30eec5$export$86b6f8925f11e682(templateId, container = null, values = {}, attributes = null, allowHTML = false) {\n    let newElement;\n    const template = document.getElementById(templateId);\n    if (template) {\n        newElement = template.content.firstElementChild.cloneNode(true);\n        for(const key in values){\n            const targetElements = newElement.querySelectorAll(`.${key}`);\n            targetElements.forEach((targetElement)=>{\n                if (targetElement) switch(targetElement.tagName){\n                    case \"IMG\":\n                        targetElement.src = values[key];\n                        break;\n                    case \"A\":\n                        targetElement.href = values[key];\n                        break;\n                    case \"TEXTAREA\":\n                    case \"SELECT\":\n                    case \"INPUT\":\n                        targetElement.value = values[key];\n                        break;\n                    default:\n                        targetElement[allowHTML ? \"innerHTML\" : \"innerText\"] = values[key];\n                        break;\n                }\n            });\n        }\n        if (attributes) {\n            for(const key in attributes)if (newElement.getAttribute(key)) newElement.setAttribute(key, attributes[key]);\n            else {\n                const attributes = newElement.querySelectorAll(`[${key}]`);\n                attributes.forEach((attr)=>{\n                    attr.setAttribute(key, attributes[key]);\n                });\n            }\n        }\n        if (container) container.appendChild(newElement);\n    } else newElement = $0cde2d9f4d30eec5$export$ab2fe02786cfa43c(\"div\", `Template not found: ${templateId}`, container, \"error\");\n    return newElement;\n}\nfunction $0cde2d9f4d30eec5$export$ab2fe02786cfa43c(elementType, elementText, parentElement = null, elementClass = \"\", elementAttributes = null, allowHTML = false) {\n    let newElement = document.createElement(elementType);\n    elementType = elementType.toLowerCase();\n    if (elementAttributes && typeof elementAttributes == \"object\" && Object.keys(elementAttributes).length) for(const attributeName in elementAttributes)newElement.setAttribute(attributeName, elementAttributes[attributeName]);\n    $0cde2d9f4d30eec5$export$68a589e25833f984(newElement, elementClass);\n    if (elementText && elementText.length && Array.isArray(elementText)) {\n        // If type is a list and text is an array, build list items\n        if (elementType == \"ul\" || elementType == \"ol\") for (const listItemText of elementText){\n            const newListItem = document.createElement(\"li\");\n            newListItem[allowHTML ? \"innerHTML\" : \"innerText\"] = listItemText;\n            newElement.appendChild(newListItem);\n        }\n        else if (elementType == \"select\" || elementType == \"datalist\") for (const optionItemText of elementText){\n            const [optValue, optLabel, optGroup] = optionItemText.split(\"|\");\n            const newOptionItem = document.createElement(\"option\");\n            newOptionItem[allowHTML ? \"innerHTML\" : \"innerText\"] = optLabel ?? optValue;\n            newOptionItem.value = optValue;\n            if (optGroup !== undefined) {\n                let optionGroup = newElement.querySelector(`optgroup[label=\"${optGroup}\"]`);\n                if (optionGroup === undefined || optionGroup === null) {\n                    optionGroup = document.createElement(\"optgroup\");\n                    optionGroup.label = optGroup;\n                    newElement.appendChild(optionGroup);\n                }\n                optionGroup.appendChild(newOptionItem);\n            } else newElement.appendChild(newOptionItem);\n        }\n        else newElement[allowHTML ? \"innerHTML\" : \"innerText\"] = elementText[0];\n    } else if (elementText && elementText.length) {\n        if (elementType == \"img\") newElement.alt = elementText;\n        else if (elementType == \"input\" && elementText.length > 0) {\n            const actualNewElement = newElement;\n            const newElementLabel = document.createElement(\"label\");\n            newElement = document.createElement(\"div\");\n            newElement.id = `${actualNewElement.id}-wrapper`;\n            if (elementClass.length > 0) newElement.classList.add((Array.isArray(elementClass) ? elementClass[0] : elementClass) + \"-wrapper\");\n            newElementLabel.setAttribute(\"for\", actualNewElement.id);\n            newElementLabel[allowHTML ? \"innerHTML\" : \"innerText\"] = elementText;\n            if (actualNewElement.getAttribute(\"type\") == \"radio\" || actualNewElement.getAttribute(\"type\") == \"checkbox\") {\n                newElementLabel.classList.add(`input-box-label`);\n                newElement.append(actualNewElement, newElementLabel);\n            } else newElement.append(newElementLabel, actualNewElement);\n        } else newElement[allowHTML ? \"innerHTML\" : \"innerText\"] = elementText;\n    }\n    if (parentElement !== undefined && parentElement !== null) parentElement.appendChild(newElement);\n    return newElement;\n}\nfunction $0cde2d9f4d30eec5$export$68a589e25833f984(targetElement, classesToAdd) {\n    if (targetElement !== undefined && targetElement !== null) {\n        if (classesToAdd.length > 0) {\n            if (Array.isArray(classesToAdd)) targetElement.classList.add(...classesToAdd);\n            else if (classesToAdd && classesToAdd.length) targetElement.classList.add(classesToAdd);\n        }\n    }\n}\nfunction $0cde2d9f4d30eec5$export$c7f61ab2130ff27a(selectElement, value, text = null) {\n    const option = document.createElement(\"option\");\n    option.value = value;\n    option.innerText = text ?? value.replace(\"-\", \" \");\n    selectElement.appendChild(option);\n}\nfunction $0cde2d9f4d30eec5$export$75a10b6d475fa3b3(score, scoreMax) {\n    const scoreBox = document.createElement(\"div\");\n    const scoreValueBox = document.createElement(\"span\");\n    for(let i = 1; i <= scoreMax; i++)scoreValueBox.appendChild($0cde2d9f4d30eec5$var$createRatingScoreElement(i, scoreMax, score));\n    scoreBox.appendChild(scoreValueBox);\n    return scoreBox;\n}\nfunction $0cde2d9f4d30eec5$var$createRatingScoreElement(currElement, maxElements, score) {\n    const newSVG = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n    const newUse = document.createElementNS(\"http://www.w3.org/2000/svg\", \"use\");\n    const scoreRounded = Math.max(Math.min(Math.round(score), maxElements), 0);\n    if (scoreRounded >= currElement) {\n        newSVG.classList.add(\"scored\");\n        if (currElement > score && score % 1 >= 0.5) newUse.setAttribute(\"mask\", \"url(#halfscore)\");\n    }\n    newSVG.classList.add(\"points\");\n    newUse.setAttribute(\"href\", \"#points-image\");\n    newUse.setAttribute(\"xlink:href\", \"#points-image\");\n    newSVG.appendChild(newUse);\n    return newSVG;\n}\n\n\nclass $af52c35e5b445fe5$export$2e2bcd8739ae039 {\n    constructor(){\n        this.products = [];\n        const cartForm = document.querySelector(\"#cart-products\");\n        if (cartForm) cartForm.addEventListener(\"submit\", this.onQuantityChange.bind(this));\n        const cartDialogClose = document.querySelector(\"#cart-close\");\n        if (cartDialogClose) cartDialogClose.addEventListener(\"click\", (event)=>{\n            document.querySelector(\"#shoppingcart\").close();\n        });\n        const cartDialogCheckout = document.querySelector(\"#cart-checkout\");\n        if (cartDialogCheckout) cartDialogCheckout.addEventListener(\"click\", (event)=>{\n            alert(\"Not implemented. (Yet?)\");\n        });\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Get the number of unique products present in the shopping cart (not including quantity)\n    get productCount() {\n        return this.products.length;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Get the total price of all items in the shopping cart.\n    getPriceSum() {\n        let sum = 0;\n        this.products.forEach((product)=>{\n            sum += product.price * product.quantity;\n        });\n        return sum;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Add a product to the shopping cart. \n    addProduct(id, name, quantity, price) {\n        if (!isNaN(id) && id > 0 && !isNaN(quantity) && quantity > 0) {\n            const product = {\n                id: id,\n                name: name,\n                quantity: Number(quantity),\n                price: Number(price)\n            };\n            this.products.push(product);\n            this.updateProductCountDisplay();\n            this.showAddedIndicator(id, true);\n        }\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Remove a product from the shopping cart. \n    removeProduct(id) {\n        const idx = this.products.findIndex((product)=>product.id == id);\n        if (idx !== -1) {\n            this.products.splice(idx, 1);\n            this.updateProductCountDisplay();\n            this.showAddedIndicator(id, false);\n        }\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Update the quantity of a product in the shopping cart. \n    updateProduct(id, quantity) {\n        const product = this.products.find((product)=>product.id == id);\n        if (product && !isNaN(quantity)) product.quantity = quantity ? quantity : 1;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Create a list of all items in the shopping cart with form controls to change quantity.\n    buildProductList() {\n        const container = document.querySelector(\"#cart-productlist\");\n        const priceSumBox = document.querySelector(\"#cart-price-sum\");\n        priceSumBox.innerText = `Price total: $${this.getPriceSum()}`;\n        container.innerHTML = \"\";\n        for (const product of this.products)$0cde2d9f4d30eec5$export$86b6f8925f11e682(\"tpl-product-cart\", container, product, {\n            \"data-productid\": product.id.toString()\n        });\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Display the shopping cart in a popup dialog.\n    show() {\n        const shoppingCartDialog = document.querySelector(\"#shoppingcart\");\n        this.buildProductList();\n        shoppingCartDialog.showModal();\n        document.querySelector(\"#cart-close\").focus();\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Event handler when changing the quantity of an item in the cart. If set to zero the item is removed from the cart. \n    onQuantityChange(event) {\n        event.preventDefault();\n        const productRow = event.submitter.closest(\"article\");\n        if (productRow) {\n            const priceSumBox = document.querySelector(\"#cart-price-sum\");\n            const id = Number(productRow.dataset.productid);\n            const qty = Number(productRow.querySelector(\".quantity\").value);\n            if (qty <= 0 && id) {\n                this.removeProduct(id);\n                this.buildProductList();\n            } else if (id && qty) {\n                this.updateProduct(id, qty);\n                priceSumBox.innerText = `Price total: $${this.getPriceSum()}`;\n            }\n        }\n        event.submitter.blur();\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Updates the indicator next to the shopping cart icon with the number of items in the cart. \n    updateProductCountDisplay() {\n        document.querySelector(\"#show-cart-count\").innerText = this.productCount.toString();\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Toggle showing an indicator on a displayed product card that the item is in the cart. \n    showAddedIndicator(id, isVisible) {\n        const formElement = document.querySelector(`article[data-productid=\"${id}\"] form`);\n        if (formElement) formElement.classList[isVisible ? \"add\" : \"remove\"](\"bought\");\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Check if a product with the specified product ID is in the shopping cart. \n    isInCart(id) {\n        return this.products.findIndex((product)=>product.id == id) !== -1;\n    }\n}\n\n\n\nclass $d12c69fb21ccda24$export$2e2bcd8739ae039 {\n    constructor(apiUrl, resultsPerPage = 20){\n        this.api = new (0, $6b2c46a57cbfd4b0$export$2e2bcd8739ae039)(apiUrl);\n        this.cart = new (0, $af52c35e5b445fe5$export$2e2bcd8739ae039)();\n        this.pageSize = resultsPerPage;\n        this.currentResult = {\n            products: [],\n            total: 0,\n            skip: 0,\n            limit: 0\n        };\n    }\n    // Get the total number of result pages of the current product result.\n    get resultPages() {\n        return Math.ceil(this.currentResult.total / this.pageSize);\n    }\n    // Get the currently shown page of the current product result.\n    get currentPage() {\n        return Math.ceil(this.currentResult.skip / this.pageSize + 1);\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Load categories from API as options of select form element.\n    async loadCategories(catSelect) {\n        if (catSelect) {\n            const categories = await this.api.getJson(\"products/categories\");\n            categories.sort((a, b)=>a.localeCompare(b));\n            catSelect.innerHTML = \"\";\n            $0cde2d9f4d30eec5$export$c7f61ab2130ff27a(catSelect, \"\", \"- All categories -\");\n            for (const category of categories)$0cde2d9f4d30eec5$export$c7f61ab2130ff27a(catSelect, category);\n        }\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Display all products matching the specified name filter, or all products if unspecified. \n    async getProducts(nameFilter = \"\", resultPage = 0) {\n        const queryParams = {\n            q: nameFilter,\n            limit: this.pageSize.toString(),\n            skip: (this.pageSize * resultPage).toString()\n        };\n        const response = await this.api.getJson(nameFilter.length ? \"products/search\" : \"products\", queryParams);\n        this.currentResult = response;\n        this.showResultNav(response.products.length < response.total);\n        this.displayProducts(response);\n        return response;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Display all products belonging to the specified category. \n    async getProductsByCategory(categoryFilter = \"\", resultPage = 0) {\n        const queryParams = {\n            limit: this.pageSize.toString(),\n            skip: (this.pageSize * resultPage).toString()\n        };\n        const response = await this.api.getJson(categoryFilter.length ? `products/category/${categoryFilter}` : `products`, queryParams);\n        this.currentResult = response;\n        this.showResultNav(response.products.length < response.total);\n        this.displayProducts(response);\n        return response;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Display the specified page of products results.\n    async getProductsPage(pageType, pageNum = 0) {\n        let resultPage = Math.ceil(this.currentResult.skip / this.pageSize);\n        const maxPage = Math.ceil(this.currentResult.total / this.pageSize);\n        if (pageNum && pageNum <= maxPage && pageType == \"page\") resultPage = pageNum - 1;\n        else switch(pageType){\n            case \"prev\":\n                resultPage = resultPage - 1 >= 0 ? resultPage - 1 : 1;\n                break;\n            case \"next\":\n                resultPage = resultPage + 1 < maxPage ? resultPage + 1 : maxPage;\n                break;\n            case \"first\":\n                resultPage = 0;\n                break;\n            case \"last\":\n                resultPage = maxPage - 1;\n                break;\n        }\n        const queryParams = {\n            skip: (this.pageSize * resultPage).toString()\n        };\n        const response = await this.api.repeatRequestJson(\"\", queryParams);\n        this.currentResult = response;\n        this.showResultNav(response.products.length < response.total);\n        this.displayProducts(response);\n        return response;\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Display all the specified products on the page. \n    displayProducts(productData) {\n        const productsBox = document.querySelector(\"#productlist\");\n        const summaryBox = document.querySelector(\"#search-summary\");\n        if (summaryBox) {\n            summaryBox.innerText = `Found ${productData.total} product${productData.total != 1 ? \"s\" : \"\"}.`;\n            if (productData.total > productData.products.length) {\n                const bounds = this.currentResult.skip + this.pageSize > productData.total ? productData.total : this.currentResult.skip + this.pageSize;\n                summaryBox.innerText += ` Showing ${this.currentResult.skip + 1} to ${bounds}`;\n            }\n        }\n        if (productsBox) {\n            productsBox.innerHTML = \"\";\n            if (productData.total > 0 && productData.products.length > 0) for (const product of productData.products){\n                const card = $0cde2d9f4d30eec5$export$86b6f8925f11e682(\"tpl-product-card\", productsBox, product, {\n                    \"data-productid\": product.id.toString()\n                });\n                card.addEventListener(\"click\", this.onProductClick.bind(this));\n                card.querySelector(\".rating\").prepend($0cde2d9f4d30eec5$export$75a10b6d475fa3b3(product.rating, 5));\n                card.querySelector(\"form\").addEventListener(\"submit\", this.onPurchaseSubmit.bind(this));\n                if (product.stock < 10) card.querySelector(\".stock\").classList.add(\"alert\");\n                if (this.cart.isInCart(product.id)) this.cart.showAddedIndicator(product.id, true);\n            }\n            else $0cde2d9f4d30eec5$export$ab2fe02786cfa43c(\"div\", \"No products found.\", productsBox, \"products-none\");\n        }\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Show or hide the control for navigating product results if more exists than the per-page limit.\n    showResultNav(isMultiplePages) {\n        const pageNav = document.querySelector(\"#pages-nav\");\n        if (isMultiplePages) {\n            const resultPage = Math.ceil(this.currentResult.skip / this.pageSize) + 1;\n            const maxPage = Math.ceil(this.currentResult.total / this.pageSize);\n            pageNav.querySelector(\"#pages-nav-goto\").innerHTML = `Page ${resultPage} / ${maxPage}`;\n            pageNav.querySelector(\"#pages-nav-first\").disabled = resultPage <= 1;\n            pageNav.querySelector(\"#pages-nav-prev\").disabled = resultPage <= 1;\n            pageNav.querySelector(\"#pages-nav-next\").disabled = resultPage == maxPage;\n            pageNav.querySelector(\"#pages-nav-last\").disabled = resultPage == maxPage;\n            pageNav.classList.add(\"show\");\n        } else pageNav.classList.remove(\"show\");\n    }\n    //////////////////////////////////////////////////////////////////////////////////////////////\n    // Get information about a currently displayed product by its product ID. \n    findCurrentProductById(productId) {\n        return this.currentResult.products.find((product)=>product.id == productId);\n    }\n}\n\n\nconst $ad2bcec7a0192558$var$shop = new (0, $d12c69fb21ccda24$export$2e2bcd8739ae039)(\"https://dummyjson.com\");\n$ad2bcec7a0192558$var$shop.onProductClick = $ad2bcec7a0192558$var$onProductClick;\n$ad2bcec7a0192558$var$shop.onPurchaseSubmit = $ad2bcec7a0192558$var$onPurchaseSubmit;\n$ad2bcec7a0192558$var$shop.loadCategories(document.querySelector(\"#search-category\")).catch(alert);\n$ad2bcec7a0192558$var$shop.getProducts().catch(alert);\ndocument.querySelector(\"#categoryform\").addEventListener(\"submit\", $ad2bcec7a0192558$var$onCategorySubmit);\ndocument.querySelector(\"#searchform\").addEventListener(\"submit\", $ad2bcec7a0192558$var$onSearchSubmit);\ndocument.querySelector(\"#pages-nav\").addEventListener(\"submit\", $ad2bcec7a0192558$var$onResultPageNav);\ndocument.querySelector(\"#pages-goto-form\").addEventListener(\"submit\", $ad2bcec7a0192558$var$onGotoPageSubmit);\ndocument.querySelector(\"#search-product\").addEventListener(\"click\", (event)=>event.currentTarget.select());\ndocument.querySelector(\"#show-cart\").addEventListener(\"click\", $ad2bcec7a0192558$var$onShoppingCartShow);\n//////////////////////////////////////////////////////////////////////////////////////////////\n// Event handler for the category filter form\nfunction $ad2bcec7a0192558$var$onCategorySubmit(event) {\n    event.preventDefault();\n    const formData = new FormData(event.currentTarget);\n    $ad2bcec7a0192558$var$shop.getProductsByCategory(formData.get(\"category\") ?? \"\").catch(alert);\n    document.querySelector(\"#search-product\").value = \"\";\n    event.currentTarget.querySelector(\"button\").blur();\n}\n//////////////////////////////////////////////////////////////////////////////////////////////\n// Event handler for the search filter form\nfunction $ad2bcec7a0192558$var$onSearchSubmit(event) {\n    event.preventDefault();\n    const formData = new FormData(event.currentTarget);\n    $ad2bcec7a0192558$var$shop.getProducts(formData.get(\"product\") ?? \"\").catch(alert);\n    document.querySelector(\"#search-category\").value = \"\";\n    event.currentTarget.querySelector(\"button\").blur();\n}\n//////////////////////////////////////////////////////////////////////////////////////////////\n// Event handler for the buy product forms, adding it to the shopping cart. \nfunction $ad2bcec7a0192558$var$onPurchaseSubmit(event) {\n    event.preventDefault();\n    const productId = event.currentTarget.closest(\"article\").dataset.productid;\n    const formData = new FormData(event.currentTarget);\n    const product = $ad2bcec7a0192558$var$shop.findCurrentProductById(productId);\n    if (product) $ad2bcec7a0192558$var$shop.cart.addProduct(productId, product.title, Number(formData.get(\"quantity\")) ?? 1, product.price);\n    event.currentTarget.reset();\n    event.currentTarget.querySelector(\"input\").blur();\n    event.currentTarget.querySelector(\"button\").blur();\n}\n//////////////////////////////////////////////////////////////////////////////////////////////\n// Event handler to focus its buy quantity field when clicking on a product card\nfunction $ad2bcec7a0192558$var$onProductClick(event) {\n    const buyButton = event.currentTarget.querySelector(\"form button\");\n    if (event.target != buyButton) {\n        const qtyField = event.currentTarget.querySelector(\"form input\");\n        qtyField.focus();\n        qtyField.select();\n    }\n}\n//////////////////////////////////////////////////////////////////////////////////////////////\n// Event handler for the product results page navigation form\nfunction $ad2bcec7a0192558$var$onResultPageNav(event) {\n    event.preventDefault();\n    switch(event.submitter.id){\n        case \"pages-nav-prev\":\n            $ad2bcec7a0192558$var$shop.getProductsPage(\"prev\").catch(alert);\n            break;\n        case \"pages-nav-next\":\n            $ad2bcec7a0192558$var$shop.getProductsPage(\"next\").catch(alert);\n            break;\n        case \"pages-nav-first\":\n            $ad2bcec7a0192558$var$shop.getProductsPage(\"first\").catch(alert);\n            break;\n        case \"pages-nav-last\":\n            $ad2bcec7a0192558$var$shop.getProductsPage(\"last\").catch(alert);\n            break;\n        case \"pages-nav-goto\":\n            const pageInput = document.querySelector(\"#pages-goto-page\");\n            pageInput.setAttribute(\"max\", $ad2bcec7a0192558$var$shop.resultPages.toString());\n            pageInput.value = $ad2bcec7a0192558$var$shop.currentPage.toString();\n            pageInput.select();\n            document.querySelector(\"#pages-goto-dialog\").showModal();\n            break;\n    }\n    event.submitter.blur();\n}\n//////////////////////////////////////////////////////////////////////////////////////////////\n// Event handler when submitting the Go to Page form in the popup dialog. \nfunction $ad2bcec7a0192558$var$onGotoPageSubmit(event) {\n    event.preventDefault();\n    const dialog = event.currentTarget.closest(\"dialog\");\n    const pageInput = Number(document.querySelector(\"#pages-goto-page\").value);\n    if (!isNaN(pageInput) && pageInput > 0 && pageInput <= $ad2bcec7a0192558$var$shop.resultPages) $ad2bcec7a0192558$var$shop.getProductsPage(\"page\", pageInput).catch(alert);\n    if (dialog) dialog.close();\n}\n//////////////////////////////////////////////////////////////////////////////////////////////\n// Event handler for clicking on the button to show the shopping cart.\nfunction $ad2bcec7a0192558$var$onShoppingCartShow(event) {\n    $ad2bcec7a0192558$var$shop.cart.show();\n    event.currentTarget.blur();\n}\n\n\n//# sourceMappingURL=index.454a101c.js.map\n","/*\r\n    Dummy Webshop - Inlämningsuppgift 3 - Javascript 2 - FE23\r\n    By Kristoffer Bengtsson\r\n\r\n    main.js\r\n    Main script of the fake webshop page. Initialization and interface event handlers. \r\n*/\r\nimport Webshop from './modules/Webshop.ts';\r\n\r\n\r\nconst shop = new Webshop('https://dummyjson.com');\r\nshop.onProductClick = onProductClick;\r\nshop.onPurchaseSubmit = onPurchaseSubmit;\r\nshop.loadCategories(document.querySelector(\"#search-category\") as HTMLSelectElement).catch(alert);\r\nshop.getProducts().catch(alert);\r\n\r\n(document.querySelector(\"#categoryform\") as HTMLFormElement).addEventListener(\"submit\", onCategorySubmit);\r\n(document.querySelector(\"#searchform\") as HTMLFormElement).addEventListener(\"submit\", onSearchSubmit);\r\n(document.querySelector(\"#pages-nav\") as HTMLFormElement).addEventListener(\"submit\", onResultPageNav);\r\n(document.querySelector(\"#pages-goto-form\") as HTMLFormElement).addEventListener(\"submit\", onGotoPageSubmit);\r\n\r\n(document.querySelector(\"#search-product\") as HTMLInputElement).addEventListener(\"click\", (event) => (event.currentTarget as HTMLInputElement).select());\r\n(document.querySelector(\"#show-cart\") as HTMLButtonElement).addEventListener(\"click\", onShoppingCartShow);\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////\r\n// Event handler for the category filter form\r\nfunction onCategorySubmit(event) {\r\n    event.preventDefault();\r\n    const formData: FormData = new FormData(event.currentTarget);\r\n    shop.getProductsByCategory(formData.get(\"category\") as string ?? \"\").catch(alert);\r\n\r\n    (document.querySelector(\"#search-product\") as HTMLInputElement).value = \"\";\r\n    event.currentTarget.querySelector(\"button\").blur();\r\n}\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////\r\n// Event handler for the search filter form\r\nfunction onSearchSubmit(event) {\r\n    event.preventDefault();\r\n    const formData: FormData = new FormData(event.currentTarget);\r\n    shop.getProducts(formData.get(\"product\") as string ?? \"\").catch(alert);\r\n\r\n    (document.querySelector(\"#search-category\") as HTMLSelectElement).value = \"\";\r\n    event.currentTarget.querySelector(\"button\").blur();\r\n}\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////\r\n// Event handler for the buy product forms, adding it to the shopping cart. \r\nfunction onPurchaseSubmit(event) {\r\n    event.preventDefault();\r\n    const productId: number = event.currentTarget.closest(\"article\").dataset.productid;\r\n    const formData: FormData = new FormData(event.currentTarget);\r\n\r\n    const product = shop.findCurrentProductById(productId);\r\n    if (product) {\r\n        shop.cart.addProduct(productId, product.title, Number(formData.get(\"quantity\")) ?? 1, product.price);\r\n    }\r\n\r\n    event.currentTarget.reset();\r\n    event.currentTarget.querySelector(\"input\").blur();\r\n    event.currentTarget.querySelector(\"button\").blur();\r\n}\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////\r\n// Event handler to focus its buy quantity field when clicking on a product card\r\nfunction onProductClick(event) {\r\n    const buyButton = event.currentTarget.querySelector(\"form button\");\r\n    if (event.target != buyButton) {\r\n        const qtyField = event.currentTarget.querySelector(\"form input\");\r\n        qtyField.focus();\r\n        qtyField.select();\r\n    }\r\n}\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////\r\n// Event handler for the product results page navigation form\r\nfunction onResultPageNav(event) {\r\n    event.preventDefault();\r\n    switch (event.submitter.id) {\r\n        case \"pages-nav-prev\": shop.getProductsPage('prev').catch(alert); break;\r\n        case \"pages-nav-next\": shop.getProductsPage('next').catch(alert); break;\r\n        case \"pages-nav-first\": shop.getProductsPage('first').catch(alert); break;\r\n        case \"pages-nav-last\": shop.getProductsPage('last').catch(alert); break;\r\n        case \"pages-nav-goto\": // Show popup dialog for navigating to specific product page\r\n            const pageInput = document.querySelector(\"#pages-goto-page\") as HTMLInputElement;\r\n            pageInput.setAttribute(\"max\", shop.resultPages.toString());\r\n            pageInput.value = shop.currentPage.toString();\r\n            pageInput.select();\r\n            (document.querySelector(\"#pages-goto-dialog\") as HTMLDialogElement).showModal();\r\n            break;\r\n    }\r\n    event.submitter.blur();\r\n}\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////\r\n// Event handler when submitting the Go to Page form in the popup dialog. \r\nfunction onGotoPageSubmit(event) {\r\n    event.preventDefault();\r\n    const dialog = event.currentTarget.closest(\"dialog\");\r\n    const pageInput: number = Number((document.querySelector(\"#pages-goto-page\") as HTMLInputElement).value);\r\n\r\n    if (!isNaN(pageInput) && (pageInput > 0) && (pageInput <= shop.resultPages)) {\r\n        shop.getProductsPage('page', pageInput).catch(alert);\r\n    }\r\n    if (dialog) {\r\n        dialog.close();\r\n    }\r\n}\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////\r\n// Event handler for clicking on the button to show the shopping cart.\r\nfunction onShoppingCartShow(event) {\r\n    shop.cart.show();\r\n    event.currentTarget.blur();\r\n}\r\n","/*\r\n    Dummy Webshop - Inlämningsuppgift 3 - Javascript 2 - FE23\r\n    By Kristoffer Bengtsson\r\n\r\n    Webshop.js\r\n    Main class of the fake webshop. Fetch and display products. \r\n*/\r\nimport RestApi from './RestApi.ts';\r\nimport ShoppingCart from './ShoppingCart.ts';\r\nimport * as utilities from './utilities.ts';\r\nimport { APIQueryParams, ProductsResult, Product } from './TypeDefinitions.ts';\r\n\r\n\r\nexport default class Webshop {\r\n    private api: RestApi;\r\n    private currentResult: ProductsResult;\r\n    public readonly cart: ShoppingCart;\r\n    public readonly pageSize: number;\r\n    public onPurchaseSubmit: Function;\r\n    public onProductClick: Function;\r\n\r\n    constructor(apiUrl: string, resultsPerPage: number = 20) {\r\n        this.api = new RestApi(apiUrl);\r\n        this.cart = new ShoppingCart();\r\n        this.pageSize = resultsPerPage;\r\n        this.currentResult = {\r\n            products: [],\r\n            total: 0,\r\n            skip: 0,\r\n            limit: 0\r\n        };\r\n    }\r\n\r\n    // Get the total number of result pages of the current product result.\r\n    public get resultPages(): number {\r\n        return Math.ceil(this.currentResult.total / this.pageSize);\r\n    }\r\n\r\n    // Get the currently shown page of the current product result.\r\n    public get currentPage(): number {\r\n        return Math.ceil((this.currentResult.skip / this.pageSize) + 1);\r\n    }\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Load categories from API as options of select form element.\r\n    public async loadCategories(catSelect: HTMLSelectElement): Promise<void> {\r\n        if (catSelect) {\r\n            const categories: string[] = await this.api.getJson(\"products/categories\");\r\n\r\n            categories.sort((a: string, b: string) => a.localeCompare(b));\r\n\r\n            catSelect.innerHTML = \"\";\r\n            utilities.addSelectOption(catSelect, \"\", \"- All categories -\");\r\n            for (const category of categories) {\r\n                utilities.addSelectOption(catSelect, category);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Display all products matching the specified name filter, or all products if unspecified. \r\n    public async getProducts(nameFilter: string = '', resultPage: number = 0): Promise<ProductsResult> {\r\n        const queryParams: APIQueryParams = {\r\n            q: nameFilter,\r\n            limit: this.pageSize.toString(),\r\n            skip: (this.pageSize * resultPage).toString()\r\n        }\r\n\r\n        const response: ProductsResult = await this.api.getJson(nameFilter.length ? \"products/search\" : \"products\", queryParams);\r\n        this.currentResult = response;\r\n        this.showResultNav(response.products.length < response.total);\r\n        this.displayProducts(response);\r\n        return response;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Display all products belonging to the specified category. \r\n    public async getProductsByCategory(categoryFilter: string = '', resultPage: number = 0): Promise<ProductsResult> {\r\n        const queryParams: APIQueryParams = {\r\n            limit: this.pageSize.toString(),\r\n            skip: (this.pageSize * resultPage).toString()\r\n        }\r\n\r\n        const response: ProductsResult = await this.api.getJson(categoryFilter.length ? `products/category/${categoryFilter}` : `products`, queryParams);\r\n        this.currentResult = response;\r\n        this.showResultNav(response.products.length < response.total);\r\n        this.displayProducts(response);\r\n        return response;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Display the specified page of products results.\r\n    public async getProductsPage(pageType: 'prev' | 'next' | 'first' | 'last' | 'page', pageNum: number = 0): Promise<ProductsResult> {\r\n        let resultPage = Math.ceil(this.currentResult.skip / this.pageSize);\r\n        const maxPage = Math.ceil(this.currentResult.total / this.pageSize);\r\n\r\n        if (pageNum && (pageNum <= maxPage) && (pageType == 'page')) {\r\n            resultPage = (pageNum - 1);\r\n        }\r\n        else {\r\n            switch (pageType) {\r\n                case 'prev': resultPage = (resultPage - 1 >= 0 ? resultPage - 1 : 1); break;\r\n                case 'next': resultPage = (resultPage + 1 < maxPage ? resultPage + 1 : maxPage); break;\r\n                case 'first': resultPage = 0; break;\r\n                case 'last': resultPage = maxPage - 1; break;\r\n            }\r\n        }\r\n\r\n        const queryParams = { skip: (this.pageSize * resultPage).toString() }\r\n        const response: ProductsResult = await this.api.repeatRequestJson('', queryParams);\r\n\r\n        this.currentResult = response;\r\n        this.showResultNav(response.products.length < response.total);\r\n        this.displayProducts(response);\r\n        return response;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Display all the specified products on the page. \r\n    public displayProducts(productData: ProductsResult) {\r\n        const productsBox = document.querySelector(\"#productlist\") as HTMLElement;\r\n        const summaryBox = document.querySelector(\"#search-summary\") as HTMLDivElement;\r\n\r\n        if (summaryBox) {\r\n            summaryBox.innerText = `Found ${productData.total} product${productData.total != 1 ? \"s\" : \"\"}.`;\r\n            if (productData.total > productData.products.length) {\r\n                const bounds = (this.currentResult.skip + this.pageSize > productData.total ? productData.total : this.currentResult.skip + this.pageSize);\r\n                summaryBox.innerText += ` Showing ${this.currentResult.skip + 1} to ${bounds}`;\r\n            }\r\n        }\r\n        if (productsBox) {\r\n            productsBox.innerHTML = \"\";\r\n            if ((productData.total > 0) && (productData.products.length > 0)) {\r\n                for (const product of productData.products) {\r\n                    const card = utilities.createHTMLFromTemplate(\"tpl-product-card\", productsBox, product, { \"data-productid\": product.id.toString() });\r\n                    card.addEventListener(\"click\", this.onProductClick.bind(this));\r\n                    (card.querySelector(\".rating\") as HTMLElement).prepend(utilities.createRatingScoreDisplay(product.rating, 5));\r\n                    (card.querySelector(\"form\") as HTMLFormElement).addEventListener(\"submit\", this.onPurchaseSubmit.bind(this));\r\n\r\n                    if (product.stock < 10) {\r\n                        (card.querySelector(\".stock\") as HTMLElement).classList.add(\"alert\");\r\n                    }\r\n\r\n                    if (this.cart.isInCart(product.id)) {\r\n                        this.cart.showAddedIndicator(product.id, true);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                utilities.createHTMLElement(\"div\", \"No products found.\", productsBox, 'products-none');\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Show or hide the control for navigating product results if more exists than the per-page limit.\r\n    public showResultNav(isMultiplePages: boolean): void {\r\n        const pageNav = document.querySelector(\"#pages-nav\") as HTMLFormElement;\r\n        if (isMultiplePages) {\r\n            const resultPage = Math.ceil(this.currentResult.skip / this.pageSize) + 1;\r\n            const maxPage = Math.ceil(this.currentResult.total / this.pageSize);\r\n\r\n            (pageNav.querySelector(\"#pages-nav-goto\") as HTMLButtonElement).innerHTML = `Page ${resultPage} / ${maxPage}`;\r\n            (pageNav.querySelector(\"#pages-nav-first\") as HTMLButtonElement).disabled = (resultPage <= 1);\r\n            (pageNav.querySelector(\"#pages-nav-prev\") as HTMLButtonElement).disabled = (resultPage <= 1);\r\n            (pageNav.querySelector(\"#pages-nav-next\") as HTMLButtonElement).disabled = (resultPage == maxPage);\r\n            (pageNav.querySelector(\"#pages-nav-last\") as HTMLButtonElement).disabled = (resultPage == maxPage);\r\n\r\n            pageNav.classList.add(\"show\");\r\n        }\r\n        else {\r\n            pageNav.classList.remove(\"show\");\r\n        }\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Get information about a currently displayed product by its product ID. \r\n    public findCurrentProductById(productId: number): Product | undefined {\r\n        return this.currentResult.products.find((product) => product.id == productId);\r\n    }\r\n}\r\n","/*\r\n    Dummy Webshop - Inlämningsuppgift 3 - Javascript 2 - FE23\r\n    By Kristoffer Bengtsson\r\n\r\n    RestApi.js\r\n    Generic class for making requests to a REST API using JSON data. \r\n*/\r\nimport { APIQueryParams, APIQueryValue, APIQueryData, APILastRequest } from './TypeDefinitions.ts';\r\n\r\n\r\nexport default class RestApi {\r\n    private readonly urlBase: string;\r\n    private readonly urlSuffix: string;\r\n    private lastRequest: APILastRequest;\r\n\r\n    constructor(baseUrl: string, urlSuffix: string = \"\") {\r\n        this.urlBase = baseUrl;\r\n        this.urlSuffix = urlSuffix;\r\n        this.lastRequest = {\r\n            url: null,\r\n            method: \"None\",\r\n            options: undefined\r\n        };\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Send GET request to API\r\n    async getJson<Type>(urlPath: string = '', queryParams: APIQueryParams = null): Promise<Type> {\r\n        const response = await fetch(this.buildRequestUrl(urlPath, queryParams));\r\n        const result = await response.json();\r\n        if (!response.ok) {\r\n            this.handleResponseErrors(response, result);\r\n        }\r\n        this.lastRequest.method = 'GET';\r\n        this.lastRequest.options = undefined;\r\n        return result as Type;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Send POST request to API\r\n    async postJson<Type>(urlPath: string = '', formData: APIQueryData = null, queryParams: APIQueryParams = null): Promise<Type> {\r\n        let response = await fetch(this.buildRequestUrl(urlPath, queryParams), this.getFetchOptions(\"POST\", formData ?? {}));\r\n        let result = await response.json();\r\n        if (!response.ok) {\r\n            this.handleResponseErrors(response, result);\r\n        }\r\n        this.lastRequest.method = 'POST';\r\n        return result as Type;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Send PATCH request to API\r\n    async updateJson<Type>(urlPath: string = '', formData: APIQueryData = null, queryParams: APIQueryParams = null): Promise<Type> {\r\n        let response = await fetch(this.buildRequestUrl(urlPath, queryParams), this.getFetchOptions(\"PATCH\", formData ?? {}));\r\n        let result = await response.json();\r\n        if (!response.ok) {\r\n            this.handleResponseErrors(response, result);\r\n        }\r\n        this.lastRequest.method = 'PATCH';\r\n        return result as Type;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Send DELETE request to API\r\n    async deleteJson<Type>(urlPath: string = '', formData: APIQueryData = null, queryParams: APIQueryParams = null): Promise<Type> {\r\n        let response = await fetch(this.buildRequestUrl(urlPath, queryParams), this.getFetchOptions(\"DELETE\", formData ?? {}));\r\n        let result = await response.json();\r\n        if (!response.ok) {\r\n            this.handleResponseErrors(response, result);\r\n        }\r\n        this.lastRequest.method = 'DELETE';\r\n        return result as Type;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Repeat latest request, with optional modifications.\r\n    // If urlPath or queryParams is set they will override that existing value of the last request. \r\n    async repeatRequestJson<Type>(urlPath: string = '', queryParams: APIQueryParams = null): Promise<Type> {\r\n        const response = await fetch(this.rebuildRequestUrl(urlPath, queryParams), this.lastRequest.options ?? {});\r\n        const result = await response.json();\r\n        if (!response.ok) {\r\n            this.handleResponseErrors(response, result);\r\n        }\r\n        return result as Type;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Create a json-encoded object from a FormData object\r\n    formdataToJson(formData: FormData): string {\r\n        var dataObject = {};\r\n        if (formData instanceof FormData) {\r\n            formData.forEach((value, key) => {\r\n                // In case the remote api is type sensitive (like Firebase), convert to numbers and booleans from the FormData strings \r\n                let currValue: APIQueryValue = value as string;\r\n                if (!isNaN(Number(value))) {\r\n                    currValue = Number(value as string);\r\n                }\r\n                else if ((value === \"true\") || (value === \"false\")) {\r\n                    currValue = (value === \"true\");\r\n                }\r\n\r\n                // Handle formdata with multiple value fields with the same name attribute (like SELECT tags \r\n                //  with the \"multiple\" attribute, checkbox groups etc)\r\n                if (!(key in dataObject)) {\r\n                    dataObject[key] = currValue;\r\n                }\r\n                else {\r\n                    if (!Array.isArray(dataObject[key])) {\r\n                        dataObject[key] = [dataObject[key]];\r\n                    }\r\n                    dataObject[key].push(currValue);\r\n                }\r\n            });\r\n        }\r\n        return JSON.stringify(dataObject);\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Assemble URL to send requests to.\r\n    private buildRequestUrl(urlPath: string = '', queryParams: APIQueryParams = null): URL {\r\n        const url: URL = new URL(`${this.urlBase}${urlPath.length ? \"/\" + urlPath : \"\"}${this.urlSuffix}`);\r\n        if (queryParams && (Object.keys(queryParams).length > 0)) {\r\n            for (const key in queryParams) {\r\n                if (Array.isArray(queryParams[key])) {\r\n                    for (const elem of queryParams[key]) {\r\n                        url.searchParams.append(key, elem);\r\n                    }\r\n                }\r\n                else {\r\n                    url.searchParams.append(key, queryParams[key] as string);\r\n                }\r\n            }\r\n        }\r\n        this.lastRequest.url = url;\r\n        return url;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Get and update last requested URL. \r\n    private rebuildRequestUrl(urlPath: string = '', queryParams: APIQueryParams = null): URL {\r\n        if (!this.lastRequest.url) {\r\n            this.lastRequest.url = this.buildRequestUrl(urlPath, queryParams);\r\n        }\r\n        else {\r\n            if (urlPath.length > 0) {\r\n                this.lastRequest.url.pathname = `/${urlPath}${this.urlSuffix}`;\r\n            }\r\n\r\n            // Set additional query params, or override existing with same name. \r\n            if (queryParams && (Object.keys(queryParams).length > 0)) {\r\n                for (const key in queryParams) {\r\n                    if (Array.isArray(queryParams[key]) && (queryParams[key].length > 0)) {\r\n                        this.lastRequest.url.searchParams.set(key, queryParams[key][0]);\r\n\r\n                        for (let i = 1; i < queryParams[key].length; i++) {\r\n                            this.lastRequest.url.searchParams.append(key, queryParams[key][i]);\r\n                        }\r\n                    }\r\n                    else {\r\n                        this.lastRequest.url.searchParams.set(key, queryParams[key] as string);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return this.lastRequest.url;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Build options object for fetch() for submitting JSON data.\r\n    private getFetchOptions(reqMethod: string, formData: APIQueryData): RequestInit {\r\n        const options: RequestInit = {\r\n            method: reqMethod,\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: (formData instanceof FormData ? this.formdataToJson(formData) : JSON.stringify(formData)),\r\n        };\r\n        this.lastRequest.options = options;\r\n        return options;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Handle error responses from the API requests\r\n    private handleResponseErrors(response: Response, result: any): void {\r\n        this.lastRequest.url = null;\r\n        this.lastRequest.method = \"None\";\r\n        this.lastRequest.options = undefined;\r\n\r\n        if ((response.status == 400)) {\r\n            throw new ApiError(response.status, `Bad request: ${result.error ?? \"\"}  (${response.statusText})`);\r\n        }\r\n        // Server errors - show the error message from API\r\n        else if (response.status == 500) {\r\n            throw new ApiError(response.status, `Server error: ${result.error ?? \"\"}  (${response.statusText})`);\r\n        }\r\n        // Other errors - show request status message\r\n        else {\r\n            throw new ApiError(response.status, `API Error: ${response.statusText}`);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n// Exception class for keeping response/error codes separate from the message text.\r\nexport class ApiError extends Error {\r\n    public readonly errorCode: number;\r\n\r\n    constructor(errorCode: number, errorMessage: string) {\r\n        super(errorMessage);\r\n        this.errorCode = errorCode;\r\n    }\r\n}","/*\r\n    Dummy Webshop - Inlämningsuppgift 3 - Javascript 2 - FE23\r\n    By Kristoffer Bengtsson\r\n\r\n    ShoppingCart.js\r\n    Class for managing the shopping cart, managing products the user is \"buying\".\r\n*/\r\nimport * as utilities from './utilities.ts';\r\nimport { CartProduct } from './TypeDefinitions.ts';\r\n\r\n\r\nexport default class ShoppingCart {\r\n    private products: CartProduct[];\r\n\r\n    constructor() {\r\n        this.products = [];\r\n\r\n        const cartForm = document.querySelector(\"#cart-products\");\r\n        if (cartForm) {\r\n            cartForm.addEventListener(\"submit\", this.onQuantityChange.bind(this));\r\n        }\r\n\r\n        const cartDialogClose = document.querySelector(\"#cart-close\");\r\n        if (cartDialogClose) {\r\n            cartDialogClose.addEventListener(\"click\", (event) => {\r\n                (document.querySelector(\"#shoppingcart\") as HTMLDialogElement).close();\r\n            });\r\n        }\r\n\r\n        const cartDialogCheckout = document.querySelector(\"#cart-checkout\");\r\n        if (cartDialogCheckout) {\r\n            cartDialogCheckout.addEventListener(\"click\", (event) => {\r\n                alert(\"Not implemented. (Yet?)\");\r\n            });\r\n        }\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Get the number of unique products present in the shopping cart (not including quantity)\r\n    public get productCount() {\r\n        return this.products.length;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Get the total price of all items in the shopping cart.\r\n    private getPriceSum(): number {\r\n        let sum: number = 0;\r\n        this.products.forEach((product) => {\r\n            sum += (product.price * product.quantity);\r\n        });\r\n        return sum;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Add a product to the shopping cart. \r\n    public addProduct(id: number, name: string, quantity: number, price: number): void {\r\n        if (!isNaN(id) && (id > 0) && !isNaN(quantity) && (quantity > 0)) {\r\n            const product: CartProduct = {\r\n                id: id,\r\n                name: name,\r\n                quantity: Number(quantity),\r\n                price: Number(price)\r\n            }\r\n\r\n            this.products.push(product);\r\n            this.updateProductCountDisplay();\r\n            this.showAddedIndicator(id, true);\r\n        }\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Remove a product from the shopping cart. \r\n    public removeProduct(id: number): void {\r\n        const idx = this.products.findIndex((product) => product.id == id);\r\n        if (idx !== -1) {\r\n            this.products.splice(idx, 1);\r\n            this.updateProductCountDisplay();\r\n            this.showAddedIndicator(id, false);\r\n        }\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Update the quantity of a product in the shopping cart. \r\n    public updateProduct(id: number, quantity: number): void {\r\n        const product = this.products.find((product) => product.id == id);\r\n        if (product && !isNaN(quantity)) {\r\n            product.quantity = (quantity ? quantity : 1);\r\n        }\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Create a list of all items in the shopping cart with form controls to change quantity.\r\n    public buildProductList(): void {\r\n        const container = document.querySelector(\"#cart-productlist\") as HTMLElement;\r\n        const priceSumBox = document.querySelector(\"#cart-price-sum\") as HTMLElement;\r\n\r\n        priceSumBox.innerText = `Price total: $${this.getPriceSum()}`;\r\n        container.innerHTML = \"\";\r\n\r\n        for (const product of this.products) {\r\n            utilities.createHTMLFromTemplate(\"tpl-product-cart\", container, product, { \"data-productid\": product.id.toString() });\r\n        }\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Display the shopping cart in a popup dialog.\r\n    public show(): void {\r\n        const shoppingCartDialog = document.querySelector(\"#shoppingcart\") as HTMLDialogElement;\r\n\r\n        this.buildProductList();\r\n        shoppingCartDialog.showModal();\r\n        (document.querySelector(\"#cart-close\") as HTMLButtonElement).focus();\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Event handler when changing the quantity of an item in the cart. If set to zero the item is removed from the cart. \r\n    private onQuantityChange(event) {\r\n        event.preventDefault();\r\n\r\n        const productRow = event.submitter.closest(\"article\") as HTMLElement;\r\n        if (productRow) {\r\n            const priceSumBox = document.querySelector(\"#cart-price-sum\") as HTMLElement;\r\n            const id: number = Number(productRow.dataset.productid);\r\n            const qty: number = Number((productRow.querySelector(\".quantity\") as HTMLInputElement).value);\r\n\r\n            if ((qty <= 0) && id) {\r\n                this.removeProduct(id);\r\n                this.buildProductList();\r\n            }\r\n            else if (id && qty) {\r\n                this.updateProduct(id, qty);\r\n                priceSumBox.innerText = `Price total: $${this.getPriceSum()}`;\r\n            }\r\n        }\r\n\r\n        event.submitter.blur();\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Updates the indicator next to the shopping cart icon with the number of items in the cart. \r\n    public updateProductCountDisplay(): void {\r\n        (document.querySelector(\"#show-cart-count\") as HTMLSpanElement).innerText = this.productCount.toString();\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Toggle showing an indicator on a displayed product card that the item is in the cart. \r\n    public showAddedIndicator(id: number, isVisible: boolean): void {\r\n        const formElement = document.querySelector(`article[data-productid=\"${id}\"] form`);\r\n        if (formElement) {\r\n            formElement.classList[isVisible ? \"add\" : \"remove\"](\"bought\");\r\n        }\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////////////////////////\r\n    // Check if a product with the specified product ID is in the shopping cart. \r\n    public isInCart(id: number): boolean {\r\n        return this.products.findIndex((product) => product.id == id) !== -1;\r\n    }\r\n}","/*\r\n    Dummy Webshop - Inlämningsuppgift 3 - Javascript 2 - FE23\r\n    By Kristoffer Bengtsson\r\n\r\n    utilities.js\r\n    My general utility functions module (trimmed down to only what is used here)\r\n*/\r\n\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n// Create and return (or attach) a HTML element based on a template.\r\n//  - templateId is the ID of the <template> tag in the HTML file to use.\r\n//  - container is the parent element to insert the new element into.\r\n//  - values is an object where the key is a classname and value is the value\r\n//    to set as innerText/HTML of the matching element within the new object\r\n//    (or href for links, src for images, value for form fields)\r\n//  - attributes is an object where the key is the name of existing attributes\r\n//    on tags in the template to set the value of. \r\nexport function createHTMLFromTemplate(templateId: string, container: HTMLElement | null = null, values: Record<string, string | number | boolean> = {}, attributes: Record<string, string> | null = null, allowHTML: boolean = false): HTMLElement {\r\n    let newElement: HTMLElement;\r\n    const template = document.getElementById(templateId) as HTMLTemplateElement;\r\n\r\n    if (template) {\r\n        newElement = template.content.firstElementChild!.cloneNode(true) as HTMLElement;\r\n\r\n        for (const key in values) {\r\n            const targetElements = newElement.querySelectorAll(`.${key}`);\r\n            targetElements.forEach((targetElement) => {\r\n                if (targetElement) {\r\n                    switch (targetElement.tagName) {\r\n                        case \"IMG\": (targetElement as HTMLImageElement).src = values[key] as string; break;\r\n                        case \"A\": (targetElement as HTMLAnchorElement).href = values[key] as string; break;\r\n                        case \"TEXTAREA\":\r\n                        case \"SELECT\":\r\n                        case \"INPUT\": (targetElement as HTMLInputElement).value = values[key] as string; break;\r\n                        default: targetElement[allowHTML ? \"innerHTML\" : \"innerText\"] = values[key] as string; break;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        if (attributes) {\r\n            for (const key in attributes) {\r\n                if (newElement.getAttribute(key)) {\r\n                    newElement.setAttribute(key, attributes[key]);\r\n                }\r\n                else {\r\n                    const attributes = newElement.querySelectorAll(`[${key}]`);\r\n                    attributes.forEach((attr) => {\r\n                        attr.setAttribute(key, attributes[key]);\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        if (container) {\r\n            container.appendChild(newElement);\r\n        }\r\n    }\r\n    else {\r\n        newElement = createHTMLElement(\"div\", `Template not found: ${templateId}`, container, 'error');\r\n    }\r\n\r\n    return newElement;\r\n}\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Oneliner to create and return a new HTML DOM element with content, optionally appending it to a parent element.\r\n//  * elementText can either be a string holding the content of the tag or the ALT of an img tag, or an array of strings \r\n//    containing the listitems/options for UL, OL, SELECT and DATALIST tags. In the case of SELECT/DATALIST the strings \r\n//    can also be formated like: SELECT: value|textlabel|optgroup      DATALIST: value|textlabel\r\n//  * elementClass can be a string or an array of strings holding CSS class(es) to apply to the element. \r\n//  * The elementAttributes parameter can be an object with a property for each attribute to set on the HTML element. \r\n// Function returns the newly created DOM element (or its wrapper element if a wrapper is created).\r\n// Remember: Set CSS \"white-space: pre-wrap;\" on element if allowHTML is true and newlines still should displayed like with innerText. \r\nexport function createHTMLElement(elementType: string, elementText: string | string[], parentElement: HTMLElement | null = null, elementClass: string | string[] = '', elementAttributes: Record<string, string> | null = null, allowHTML: boolean = false): HTMLElement {\r\n    let newElement = document.createElement(elementType);\r\n\r\n    elementType = elementType.toLowerCase();\r\n\r\n    if (elementAttributes && (typeof elementAttributes == \"object\") && Object.keys(elementAttributes).length) {\r\n        for (const attributeName in elementAttributes) {\r\n            newElement.setAttribute(attributeName, elementAttributes[attributeName]);\r\n        }\r\n    }\r\n    addClassToElement(newElement, elementClass);\r\n\r\n    if (elementText && elementText.length && Array.isArray(elementText)) {\r\n        // If type is a list and text is an array, build list items\r\n        if ((elementType == 'ul') || (elementType == 'ol')) {\r\n            for (const listItemText of elementText) {\r\n                const newListItem = document.createElement(\"li\");\r\n                newListItem[allowHTML ? \"innerHTML\" : \"innerText\"] = listItemText;\r\n                newElement.appendChild(newListItem);\r\n            }\r\n        }\r\n        // If type is a select form element and text is an array, build select option list\r\n        else if ((elementType == 'select') || (elementType == 'datalist')) {\r\n            for (const optionItemText of elementText) {\r\n                const [optValue, optLabel, optGroup] = optionItemText.split('|');\r\n                const newOptionItem = document.createElement(\"option\");\r\n\r\n                newOptionItem[allowHTML ? \"innerHTML\" : \"innerText\"] = (optLabel ?? optValue);\r\n                newOptionItem.value = optValue;\r\n\r\n                if (optGroup !== undefined) {\r\n                    let optionGroup: HTMLOptGroupElement | null = newElement.querySelector(`optgroup[label=\"${optGroup}\"]`);\r\n                    if ((optionGroup === undefined) || (optionGroup === null)) {\r\n                        optionGroup = document.createElement(\"optgroup\");\r\n                        optionGroup.label = optGroup;\r\n                        newElement.appendChild(optionGroup);\r\n                    }\r\n                    optionGroup.appendChild(newOptionItem);\r\n                }\r\n                else {\r\n                    newElement.appendChild(newOptionItem);\r\n                }\r\n            }\r\n        }\r\n        // Array but not a list-type element, just use the first string \r\n        else {\r\n            newElement[allowHTML ? \"innerHTML\" : \"innerText\"] = elementText[0];\r\n        }\r\n    }\r\n    else if (elementText && elementText.length) {\r\n        if (elementType == 'img') {\r\n            (newElement as HTMLImageElement).alt = elementText as string;\r\n        }\r\n        // Special case for input fields, create wrapper and labels for them.\r\n        else if ((elementType == 'input') && (elementText.length > 0)) {\r\n            const actualNewElement = newElement;\r\n            const newElementLabel = document.createElement(\"label\");\r\n            newElement = document.createElement(\"div\");\r\n            newElement.id = `${actualNewElement.id}-wrapper`;\r\n            if (elementClass.length > 0) {\r\n                newElement.classList.add((Array.isArray(elementClass) ? elementClass[0] : elementClass) + \"-wrapper\");\r\n            }\r\n\r\n            newElementLabel.setAttribute(\"for\", actualNewElement.id);\r\n            newElementLabel[allowHTML ? \"innerHTML\" : \"innerText\"] = elementText as string;\r\n\r\n            if ((actualNewElement.getAttribute(\"type\") == \"radio\") || (actualNewElement.getAttribute(\"type\") == \"checkbox\")) {\r\n                newElementLabel.classList.add(`input-box-label`);\r\n                newElement.append(actualNewElement, newElementLabel);\r\n            }\r\n            else {\r\n                newElement.append(newElementLabel, actualNewElement);\r\n            }\r\n        }\r\n        else {\r\n            newElement[allowHTML ? \"innerHTML\" : \"innerText\"] = elementText as string;\r\n        }\r\n    }\r\n\r\n    if ((parentElement !== undefined) && (parentElement !== null)) {\r\n        parentElement.appendChild(newElement);\r\n    }\r\n    return newElement;\r\n}\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Add CSS class(es) to a DOM element\r\nexport function addClassToElement(targetElement: HTMLElement, classesToAdd: string | string[]): void {\r\n    if ((targetElement !== undefined) && (targetElement !== null)) {\r\n        if (classesToAdd.length > 0) {\r\n            if (Array.isArray(classesToAdd)) {\r\n                targetElement.classList.add(...classesToAdd);\r\n            }\r\n            else if (classesToAdd && classesToAdd.length) {\r\n                targetElement.classList.add(classesToAdd);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Add an option to the specified select element. \r\nexport function addSelectOption(selectElement: HTMLSelectElement, value: string, text: string | null = null): void {\r\n    const option = document.createElement(\"option\");\r\n    option.value = value;\r\n    option.innerText = (text ?? value.replace(\"-\", \" \"));\r\n    selectElement.appendChild(option);\r\n}\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////////////////////////////////////\r\n// Build a rating display with stars from a rating value. Uses an inline SVG image in the HTML file.\r\nexport function createRatingScoreDisplay(score: number, scoreMax: number): HTMLElement {\r\n    const scoreBox = document.createElement(\"div\");\r\n    const scoreValueBox = document.createElement(\"span\");\r\n\r\n    for (let i = 1; i <= scoreMax; i++) {\r\n        scoreValueBox.appendChild(createRatingScoreElement(i, scoreMax, score));\r\n    }\r\n    scoreBox.appendChild(scoreValueBox);\r\n    return scoreBox;\r\n}\r\n\r\nfunction createRatingScoreElement(currElement: number, maxElements: number, score: number): SVGSVGElement {\r\n    const newSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n    const newUse = document.createElementNS('http://www.w3.org/2000/svg', 'use');\r\n    const scoreRounded: number = Math.max(Math.min(Math.round(score), maxElements), 0);\r\n\r\n    if (scoreRounded >= currElement) {\r\n        newSVG.classList.add(\"scored\");\r\n        if ((currElement > score) && ((score % 1) >= 0.5)) {\r\n            newUse.setAttribute(\"mask\", \"url(#halfscore)\");\r\n        }\r\n    }\r\n\r\n    newSVG.classList.add(\"points\");\r\n    newUse.setAttribute(\"href\", \"#points-image\");\r\n    newUse.setAttribute(\"xlink:href\", \"#points-image\");\r\n    newSVG.appendChild(newUse);\r\n    return newSVG;\r\n}"],"names":["$6b2c46a57cbfd4b0$export$2e2bcd8739ae039","constructor","baseUrl","urlSuffix","urlBase","lastRequest","url","method","options","undefined","getJson","urlPath","queryParams","response","fetch","buildRequestUrl","result","json","ok","handleResponseErrors","postJson","formData","getFetchOptions","updateJson","deleteJson","repeatRequestJson","rebuildRequestUrl","formdataToJson","dataObject","FormData","forEach","value","key","currValue","isNaN","Number","Array","isArray","push","JSON","stringify","URL","length","Object","keys","elem","searchParams","append","pathname","set","i","reqMethod","headers","body","status","$6b2c46a57cbfd4b0$export$f2e832acab1bdd79","error","statusText","Error","errorCode","errorMessage","$0cde2d9f4d30eec5$export$86b6f8925f11e682","templateId","container","values","attributes","allowHTML","newElement","template","document","getElementById","content","firstElementChild","cloneNode","targetElements","querySelectorAll","targetElement","tagName","src","href","getAttribute","setAttribute","attr","appendChild","$0cde2d9f4d30eec5$export$ab2fe02786cfa43c","elementType","elementText","parentElement","elementClass","elementAttributes","createElement","toLowerCase","attributeName","classesToAdd","classList","add","listItemText","newListItem","optionItemText","optValue","optLabel","optGroup","split","newOptionItem","optionGroup","querySelector","label","alt","actualNewElement","newElementLabel","id","$0cde2d9f4d30eec5$export$c7f61ab2130ff27a","selectElement","text","option","innerText","replace","$af52c35e5b445fe5$export$2e2bcd8739ae039","products","cartForm","addEventListener","onQuantityChange","bind","cartDialogClose","event","close","cartDialogCheckout","alert","productCount","getPriceSum","sum","product","price","quantity","addProduct","name","updateProductCountDisplay","showAddedIndicator","removeProduct","idx","findIndex","splice","updateProduct","find","buildProductList","priceSumBox","innerHTML","toString","show","shoppingCartDialog","showModal","focus","preventDefault","productRow","submitter","closest","dataset","productid","qty","blur","isVisible","formElement","isInCart","$ad2bcec7a0192558$var$shop","apiUrl","resultsPerPage","api","cart","pageSize","currentResult","total","skip","limit","resultPages","Math","ceil","currentPage","loadCategories","catSelect","categories","category","sort","a","b","localeCompare","getProducts","nameFilter","resultPage","q","showResultNav","displayProducts","getProductsByCategory","categoryFilter","getProductsPage","pageType","pageNum","maxPage","productData","productsBox","summaryBox","bounds","card","onProductClick","prepend","$0cde2d9f4d30eec5$export$75a10b6d475fa3b3","score","scoreMax","scoreBox","scoreValueBox","$0cde2d9f4d30eec5$var$createRatingScoreElement","currElement","maxElements","newSVG","createElementNS","newUse","max","min","round","rating","onPurchaseSubmit","stock","isMultiplePages","pageNav","disabled","remove","findCurrentProductById","productId","buyButton","currentTarget","target","qtyField","select","title","get","reset","catch","pageInput","dialog"],"version":3,"file":"index.454a101c.js.map"}