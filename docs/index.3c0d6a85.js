class e{constructor(e,t=""){this.urlBase=e,this.urlSuffix=t,this.lastRequest={url:null,method:"None",options:void 0}}async getJson(e="",t=null){let r=await fetch(this.buildRequestUrl(e,t)),s=await r.json();return r.ok||this.handleResponseErrors(r,s),this.lastRequest.method="GET",this.lastRequest.options=void 0,s}async postJson(e="",t=null,r=null){let s=await fetch(this.buildRequestUrl(e,r),this.getFetchOptions("POST",t??{})),a=await s.json();return s.ok||this.handleResponseErrors(s,a),this.lastRequest.method="POST",a}async updateJson(e="",t=null,r=null){let s=await fetch(this.buildRequestUrl(e,r),this.getFetchOptions("PATCH",t??{})),a=await s.json();return s.ok||this.handleResponseErrors(s,a),this.lastRequest.method="PATCH",a}async deleteJson(e="",t=null,r=null){let s=await fetch(this.buildRequestUrl(e,r),this.getFetchOptions("DELETE",t??{})),a=await s.json();return s.ok||this.handleResponseErrors(s,a),this.lastRequest.method="DELETE",a}async repeatRequestJson(e="",t=null){let r=await fetch(this.rebuildRequestUrl(e,t),this.lastRequest.options??{}),s=await r.json();return r.ok||this.handleResponseErrors(r,s),s}formdataToJson(e){var t={};return e instanceof FormData&&e.forEach((e,r)=>{let s=e;isNaN(Number(e))?("true"===e||"false"===e)&&(s="true"===e):s=Number(e),r in t?(Array.isArray(t[r])||(t[r]=[t[r]]),t[r].push(s)):t[r]=s}),JSON.stringify(t)}buildRequestUrl(e="",t=null){let r=new URL(`${this.urlBase}${e.length?"/"+e:""}${this.urlSuffix}`);if(t&&Object.keys(t).length>0)for(let e in t)if(Array.isArray(t[e]))for(let s of t[e])r.searchParams.append(e,s);else r.searchParams.append(e,t[e]);return this.lastRequest.url=r,r}rebuildRequestUrl(e="",t=null){if(this.lastRequest.url){if(e.length>0&&(this.lastRequest.url.pathname=`/${e}${this.urlSuffix}`),t&&Object.keys(t).length>0)for(let e in t)if(Array.isArray(t[e])&&t[e].length>0){this.lastRequest.url.searchParams.set(e,t[e][0]);for(let r=1;r<t[e].length;r++)this.lastRequest.url.searchParams.append(e,t[e][r])}else this.lastRequest.url.searchParams.set(e,t[e])}else this.lastRequest.url=this.buildRequestUrl(e,t);return this.lastRequest.url}getFetchOptions(e,t){let r={method:e,headers:{"Content-Type":"application/json"},body:t instanceof FormData?this.formdataToJson(t):JSON.stringify(t)};return this.lastRequest.options=r,r}handleResponseErrors(e,r){if(this.lastRequest.url=null,this.lastRequest.method="None",this.lastRequest.options=void 0,400==e.status)throw new t(e.status,`Bad request: ${r.error??""}  (${e.statusText})`);if(500==e.status)throw new t(e.status,`Server error: ${r.error??""}  (${e.statusText})`);throw new t(e.status,`API Error: ${e.statusText}`)}}class t extends Error{constructor(e,t){super(t),this.errorCode=e}}function r(e,t,r=null,s="",a=null,l=!1){var n;let i=document.createElement(e);if(e=e.toLowerCase(),a&&"object"==typeof a&&Object.keys(a).length)for(let e in a)i.setAttribute(e,a[e]);if(null!=(n=i)&&s.length>0&&(Array.isArray(s)?n.classList.add(...s):s&&s.length&&n.classList.add(s)),t&&t.length&&Array.isArray(t)){if("ul"==e||"ol"==e)for(let e of t){let t=document.createElement("li");t[l?"innerHTML":"innerText"]=e,i.appendChild(t)}else if("select"==e||"datalist"==e)for(let e of t){let[t,r,s]=e.split("|"),a=document.createElement("option");if(a[l?"innerHTML":"innerText"]=r??t,a.value=t,void 0!==s){let e=i.querySelector(`optgroup[label="${s}"]`);null==e&&((e=document.createElement("optgroup")).label=s,i.appendChild(e)),e.appendChild(a)}else i.appendChild(a)}else i[l?"innerHTML":"innerText"]=t[0]}else if(t&&t.length){if("img"==e)i.alt=t;else if("input"==e&&t.length>0){let e=i,r=document.createElement("label");(i=document.createElement("div")).id=`${e.id}-wrapper`,s.length>0&&i.classList.add((Array.isArray(s)?s[0]:s)+"-wrapper"),r.setAttribute("for",e.id),r[l?"innerHTML":"innerText"]=t,"radio"==e.getAttribute("type")||"checkbox"==e.getAttribute("type")?(r.classList.add("input-box-label"),i.append(e,r)):i.append(r,e)}else i[l?"innerHTML":"innerText"]=t}return null!=r&&r.appendChild(i),i}function s(e,t,r=null){let s=document.createElement("option");s.value=t,s.innerText=r??t.replace("-"," "),e.appendChild(s)}const a=new class{constructor(t,r=20){this.api=new e(t),this.pageSize=r,this.currentResult={products:[],total:0,skip:0,limit:0}}async loadCategories(e){if(e){let t=await this.api.getJson("products/categories");for(let r of(t.sort((e,t)=>e.localeCompare(t)),e.innerHTML="",s(e,"","- All categories -"),t))s(e,r)}}async getProducts(e="",t=0){let r={q:e,limit:this.pageSize.toString(),skip:(this.pageSize*t).toString()},s=await this.api.getJson(e.length?"products/search":"products",r);return this.currentResult=s,this.showResultNav(s.products.length<s.total),this.displayProducts(s),s}async getProductsByCategory(e="",t=0){let r={limit:this.pageSize.toString(),skip:(this.pageSize*t).toString()},s=await this.api.getJson(e.length?`products/category/${e}`:"products",r);return this.currentResult=s,this.showResultNav(s.products.length<s.total),this.displayProducts(s),s}async getProductsPage(e,t=0){let r=Math.ceil(this.currentResult.skip/this.pageSize),s=Math.ceil(this.currentResult.total/this.pageSize);if(t&&t<=s&&"page"==e)r=t-1;else switch(e){case"prev":r=r-1>=0?r-1:1;break;case"next":r=r+1<s?r+1:s;break;case"first":r=0;break;case"last":r=s-1}let a={skip:(this.pageSize*r).toString()},l=await this.api.repeatRequestJson("",a);return this.currentResult=l,this.showResultNav(l.products.length<l.total),this.displayProducts(l),l}displayProducts(e){let t=document.querySelector("#productlist"),s=document.querySelector("#search-summary");if(s&&(s.innerText=`Found ${e.total} product${1!=e.total?"s":""}.`,e.total>e.products.length)){let t=this.currentResult.skip+this.pageSize>e.total?e.total:this.currentResult.skip+this.pageSize;s.innerText+=` Showing ${this.currentResult.skip+1} to ${t}`}if(t){if(t.innerHTML="",e.total>0&&e.products.length>0)for(let s of e.products){let e=function(e,t=null,s={},a=null,l=!1){let n;let i=document.getElementById(e);if(i){for(let e in n=i.content.firstElementChild.cloneNode(!0),s){let t=n.querySelector(`.${e}`);if(t)switch(t.tagName){case"IMG":t.src=s[e];break;case"A":t.href=s[e];break;case"TEXTAREA":case"SELECT":case"INPUT":t.value=s[e];break;default:t[l?"innerHTML":"innerText"]=s[e]}}if(a)for(let e in a){let t=n.querySelector(`[${e}]`);n.getAttribute(e)?n.setAttribute(e,a[e]):t&&t.setAttribute(e,a[e])}t&&t.appendChild(n)}else n=r("div",`Template not found: ${e}`,t,"error");return n}("tpl-product-card",t,s,{"data-productid":s.id.toString()});e.addEventListener("click",this.onProductClick.bind(this)),e.querySelector(".rating").prepend(function(e,t){let r=document.createElement("div"),s=document.createElement("span");for(let t=1;t<=5;t++)s.appendChild(function(e,t,r){let s=document.createElementNS("http://www.w3.org/2000/svg","svg"),a=document.createElementNS("http://www.w3.org/2000/svg","use");return Math.max(Math.min(Math.round(r),5),0)>=e&&(s.classList.add("scored"),e>r&&r%1>=.5&&a.setAttribute("mask","url(#halfscore)")),s.classList.add("points"),a.setAttribute("href","#points-image"),s.appendChild(a),s}(t,5,e));return r.appendChild(s),r}(s.rating,0)),e.querySelector("form").addEventListener("submit",this.onPurchaseSubmit.bind(this)),s.stock<10&&e.querySelector(".stock").classList.add("alert")}else r("div","No products found.",t,"products-none")}}showResultNav(e){let t=document.querySelector("#pages-nav");if(e){let e=Math.ceil(this.currentResult.skip/this.pageSize)+1,r=Math.ceil(this.currentResult.total/this.pageSize);t.querySelector("#pages-nav-goto").innerHTML=`Page ${e} / ${r}`,t.querySelector("#pages-nav-first").disabled=e<=1,t.querySelector("#pages-nav-prev").disabled=e<=1,t.querySelector("#pages-nav-next").disabled=e==r,t.querySelector("#pages-nav-last").disabled=e==r,t.classList.add("show")}else t.classList.remove("show")}}("https://dummyjson.com");a.onProductClick=function(e){let t=e.currentTarget.querySelector("form input"),r=e.currentTarget.querySelector("form button");e.target!=r&&(t.focus(),t.select())},a.onPurchaseSubmit=function(e){e.preventDefault(),console.log("Buying! ",e.currentTarget.closest("article").dataset.productid,new FormData(e.currentTarget).get("quantity")),e.currentTarget.reset(),e.currentTarget.querySelector("input").blur(),e.currentTarget.querySelector("button").blur()},a.loadCategories(document.querySelector("#search-category")),a.getProducts(),document.querySelector("#categoryform").addEventListener("submit",function(e){e.preventDefault();let t=new FormData(e.currentTarget);a.getProductsByCategory(t.get("category")??""),document.querySelector("#search-product").value="",e.currentTarget.querySelector("button").blur()}),document.querySelector("#searchform").addEventListener("submit",function(e){e.preventDefault();let t=new FormData(e.currentTarget);a.getProducts(t.get("product")??""),document.querySelector("#search-category").value="",e.currentTarget.querySelector("button").blur()}),document.querySelector("#pages-nav").addEventListener("submit",function(e){switch(e.preventDefault(),e.submitter.id){case"pages-nav-prev":a.getProductsPage("prev");break;case"pages-nav-next":a.getProductsPage("next");break;case"pages-nav-first":a.getProductsPage("first");break;case"pages-nav-last":a.getProductsPage("last");break;case"pages-nav-goto":let t=document.querySelector("#pages-goto-page");t.setAttribute("max",Math.ceil(a.currentResult.total/a.pageSize).toString()),t.value=Math.ceil(a.currentResult.skip/a.pageSize+1).toString(),t.select(),document.querySelector("#pages-goto-dialog").showModal()}e.submitter.blur()}),document.querySelector("#pages-goto-form").addEventListener("submit",function(e){e.preventDefault();let t=e.currentTarget.closest("dialog"),r=Number(document.querySelector("#pages-goto-page").value);!isNaN(r)&&r>0&&r<=Math.ceil(a.currentResult.total/a.pageSize)&&a.getProductsPage("page",r),t&&t.close()}),document.querySelector("#search-product").addEventListener("click",e=>e.currentTarget.select());
//# sourceMappingURL=index.3c0d6a85.js.map
