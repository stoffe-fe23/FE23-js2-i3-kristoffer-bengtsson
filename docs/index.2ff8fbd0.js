class t{constructor(t,e=""){this.urlBase=t,this.urlSuffix=e,this.lastRequest={url:null,method:"None",options:void 0}}async getJson(t="",e=null){let r=await fetch(this.buildRequestUrl(t,e)),s=await r.json();return r.ok||this.handleResponseErrors(r,s),this.lastRequest.method="GET",this.lastRequest.options=void 0,s}async postJson(t="",e=null,r=null){let s=await fetch(this.buildRequestUrl(t,r),this.getFetchOptions("POST",e??{})),a=await s.json();return s.ok||this.handleResponseErrors(s,a),this.lastRequest.method="POST",a}async updateJson(t="",e=null,r=null){let s=await fetch(this.buildRequestUrl(t,r),this.getFetchOptions("PATCH",e??{})),a=await s.json();return s.ok||this.handleResponseErrors(s,a),this.lastRequest.method="PATCH",a}async deleteJson(t="",e=null,r=null){let s=await fetch(this.buildRequestUrl(t,r),this.getFetchOptions("DELETE",e??{})),a=await s.json();return s.ok||this.handleResponseErrors(s,a),this.lastRequest.method="DELETE",a}async repeatRequestJson(t="",e=null){let r=await fetch(this.rebuildRequestUrl(t,e),this.lastRequest.options??{}),s=await r.json();return r.ok||this.handleResponseErrors(r,s),s}formdataToJson(t){var e={};return t instanceof FormData&&t.forEach((t,r)=>{let s=t;isNaN(Number(t))?("true"===t||"false"===t)&&(s="true"===t):s=Number(t),r in e?(Array.isArray(e[r])||(e[r]=[e[r]]),e[r].push(s)):e[r]=s}),JSON.stringify(e)}buildRequestUrl(t="",e=null){let r=new URL(`${this.urlBase}${t.length?"/"+t:""}${this.urlSuffix}`);if(e&&Object.keys(e).length>0)for(let t in e)if(Array.isArray(e[t]))for(let s of e[t])r.searchParams.append(t,s);else r.searchParams.append(t,e[t]);return this.lastRequest.url=r,r}rebuildRequestUrl(t="",e=null){if(this.lastRequest.url){if(t.length>0&&(this.lastRequest.url.pathname=`/${t}${this.urlSuffix}`),e&&Object.keys(e).length>0)for(let t in e)if(Array.isArray(e[t])&&e[t].length>0){this.lastRequest.url.searchParams.set(t,e[t][0]);for(let r=1;r<e[t].length;r++)this.lastRequest.url.searchParams.append(t,e[t][r])}else this.lastRequest.url.searchParams.set(t,e[t])}else this.lastRequest.url=this.buildRequestUrl(t,e);return this.lastRequest.url}getFetchOptions(t,e){let r={method:t,headers:{"Content-Type":"application/json"},body:e instanceof FormData?this.formdataToJson(e):JSON.stringify(e)};return this.lastRequest.options=r,r}handleResponseErrors(t,r){if(this.lastRequest.url=null,this.lastRequest.method="None",this.lastRequest.options=void 0,400==t.status)throw new e(t.status,`Bad request: ${r.error??""}  (${t.statusText})`);if(500==t.status)throw new e(t.status,`Server error: ${r.error??""}  (${t.statusText})`);throw new e(t.status,`API Error: ${t.statusText}`)}}class e extends Error{constructor(t,e){super(e),this.errorCode=t}}function r(t,e=null,r={},a=null,i=!1){let o;let l=document.getElementById(t);if(l){for(let t in o=l.content.firstElementChild.cloneNode(!0),r)o.querySelectorAll(`.${t}`).forEach(e=>{if(e)switch(e.tagName){case"IMG":e.src=r[t];break;case"A":e.href=r[t];break;case"TEXTAREA":case"SELECT":case"INPUT":e.value=r[t];break;default:e[i?"innerHTML":"innerText"]=r[t]}});if(a)for(let t in a)if(o.getAttribute(t))o.setAttribute(t,a[t]);else{let e=o.querySelectorAll(`[${t}]`);e.forEach(r=>{r.setAttribute(t,e[t])})}e&&e.appendChild(o)}else o=s("div",`Template not found: ${t}`,e,"error");return o}function s(t,e,r=null,s="",a=null,i=!1){var o;let l=document.createElement(t);if(t=t.toLowerCase(),a&&"object"==typeof a&&Object.keys(a).length)for(let t in a)l.setAttribute(t,a[t]);if(null!=(o=l)&&s.length>0&&(Array.isArray(s)?o.classList.add(...s):s&&s.length&&o.classList.add(s)),e&&e.length&&Array.isArray(e)){if("ul"==t||"ol"==t)for(let t of e){let e=document.createElement("li");e[i?"innerHTML":"innerText"]=t,l.appendChild(e)}else if("select"==t||"datalist"==t)for(let t of e){let[e,r,s]=t.split("|"),a=document.createElement("option");if(a[i?"innerHTML":"innerText"]=r??e,a.value=e,void 0!==s){let t=l.querySelector(`optgroup[label="${s}"]`);null==t&&((t=document.createElement("optgroup")).label=s,l.appendChild(t)),t.appendChild(a)}else l.appendChild(a)}else l[i?"innerHTML":"innerText"]=e[0]}else if(e&&e.length){if("img"==t)l.alt=e;else if("input"==t&&e.length>0){let t=l,r=document.createElement("label");(l=document.createElement("div")).id=`${t.id}-wrapper`,s.length>0&&l.classList.add((Array.isArray(s)?s[0]:s)+"-wrapper"),r.setAttribute("for",t.id),r[i?"innerHTML":"innerText"]=e,"radio"==t.getAttribute("type")||"checkbox"==t.getAttribute("type")?(r.classList.add("input-box-label"),l.append(t,r)):l.append(r,t)}else l[i?"innerHTML":"innerText"]=e}return null!=r&&r.appendChild(l),l}function a(t,e,r=null){let s=document.createElement("option");s.value=e,s.innerText=r??e.replace("-"," "),t.appendChild(s)}class i{constructor(){this.products=[];let t=document.querySelector("#cart-products");t&&t.addEventListener("submit",this.onQuantityChange.bind(this));let e=document.querySelector("#cart-close");e&&e.addEventListener("click",t=>{document.querySelector("#shoppingcart").close()});let r=document.querySelector("#cart-checkout");r&&r.addEventListener("click",t=>{alert("Not implemented. (Yet?)")})}get productCount(){return this.products.length}getPriceSum(){let t=0;return this.products.forEach(e=>{t+=e.price*e.quantity}),t}addProduct(t,e,r,s){if(!isNaN(t)&&t>0&&!isNaN(r)&&r>0){let a={id:t,name:e,quantity:Number(r),price:Number(s)};this.products.push(a),this.updateProductCountDisplay(),this.showAddedIndicator(t,!0)}}removeProduct(t){let e=this.products.findIndex(e=>e.id==t);-1!==e&&(this.products.splice(e,1),this.updateProductCountDisplay(),this.showAddedIndicator(t,!1))}updateProduct(t,e){let r=this.products.find(e=>e.id==t);r&&!isNaN(e)&&(r.quantity=e||1)}buildProductList(){let t=document.querySelector("#cart-productlist");for(let e of(document.querySelector("#cart-price-sum").innerText=`Price total: $${this.getPriceSum()}`,t.innerHTML="",this.products))r("tpl-product-cart",t,e,{"data-productid":e.id.toString()})}show(){let t=document.querySelector("#shoppingcart");this.buildProductList(),t.showModal(),document.querySelector("#cart-close").focus()}onQuantityChange(t){t.preventDefault();let e=t.submitter.closest("article");if(e){let t=document.querySelector("#cart-price-sum"),r=Number(e.dataset.productid),s=Number(e.querySelector(".quantity").value);s<=0&&r?(this.removeProduct(r),this.buildProductList()):r&&s&&(this.updateProduct(r,s),t.innerText=`Price total: $${this.getPriceSum()}`)}t.submitter.blur()}updateProductCountDisplay(){document.querySelector("#show-cart-count").innerText=this.productCount.toString()}showAddedIndicator(t,e){let r=document.querySelector(`article[data-productid="${t}"] form`);r&&r.classList[e?"add":"remove"]("bought")}isInCart(t){return -1!==this.products.findIndex(e=>e.id==t)}}const o=new class{constructor(e,r=20){this.api=new t(e),this.cart=new i,this.pageSize=r,this.currentResult={products:[],total:0,skip:0,limit:0}}async loadCategories(t){if(t){let e=await this.api.getJson("products/categories");for(let r of(e.sort((t,e)=>t.localeCompare(e)),t.innerHTML="",a(t,"","- All categories -"),e))a(t,r)}}async getProducts(t="",e=0){let r={q:t,limit:this.pageSize.toString(),skip:(this.pageSize*e).toString()},s=await this.api.getJson(t.length?"products/search":"products",r);return this.currentResult=s,this.showResultNav(s.products.length<s.total),this.displayProducts(s),s}async getProductsByCategory(t="",e=0){let r={limit:this.pageSize.toString(),skip:(this.pageSize*e).toString()},s=await this.api.getJson(t.length?`products/category/${t}`:"products",r);return this.currentResult=s,this.showResultNav(s.products.length<s.total),this.displayProducts(s),s}async getProductsPage(t,e=0){let r=Math.ceil(this.currentResult.skip/this.pageSize),s=Math.ceil(this.currentResult.total/this.pageSize);if(e&&e<=s&&"page"==t)r=e-1;else switch(t){case"prev":r=r-1>=0?r-1:1;break;case"next":r=r+1<s?r+1:s;break;case"first":r=0;break;case"last":r=s-1}let a={skip:(this.pageSize*r).toString()},i=await this.api.repeatRequestJson("",a);return this.currentResult=i,this.showResultNav(i.products.length<i.total),this.displayProducts(i),i}displayProducts(t){let e=document.querySelector("#productlist"),a=document.querySelector("#search-summary");if(a&&(a.innerText=`Found ${t.total} product${1!=t.total?"s":""}.`,t.total>t.products.length)){let e=this.currentResult.skip+this.pageSize>t.total?t.total:this.currentResult.skip+this.pageSize;a.innerText+=` Showing ${this.currentResult.skip+1} to ${e}`}if(e){if(e.innerHTML="",t.total>0&&t.products.length>0)for(let s of t.products){let t=r("tpl-product-card",e,s,{"data-productid":s.id.toString()});t.addEventListener("click",this.onProductClick.bind(this)),t.querySelector(".rating").prepend(function(t,e){let r=document.createElement("div"),s=document.createElement("span");for(let e=1;e<=5;e++)s.appendChild(function(t,e,r){let s=document.createElementNS("http://www.w3.org/2000/svg","svg"),a=document.createElementNS("http://www.w3.org/2000/svg","use");return Math.max(Math.min(Math.round(r),5),0)>=t&&(s.classList.add("scored"),t>r&&r%1>=.5&&a.setAttribute("mask","url(#halfscore)")),s.classList.add("points"),a.setAttribute("href","#points-image"),a.setAttribute("xlink:href","#points-image"),s.appendChild(a),s}(e,5,t));return r.appendChild(s),r}(s.rating,0)),t.querySelector("form").addEventListener("submit",this.onPurchaseSubmit.bind(this)),s.stock<10&&t.querySelector(".stock").classList.add("alert"),this.cart.isInCart(s.id)&&this.cart.showAddedIndicator(s.id,!0)}else s("div","No products found.",e,"products-none")}}showResultNav(t){let e=document.querySelector("#pages-nav");if(t){let t=Math.ceil(this.currentResult.skip/this.pageSize)+1,r=Math.ceil(this.currentResult.total/this.pageSize);e.querySelector("#pages-nav-goto").innerHTML=`Page ${t} / ${r}`,e.querySelector("#pages-nav-first").disabled=t<=1,e.querySelector("#pages-nav-prev").disabled=t<=1,e.querySelector("#pages-nav-next").disabled=t==r,e.querySelector("#pages-nav-last").disabled=t==r,e.classList.add("show")}else e.classList.remove("show")}findCurrentProductById(t){return this.currentResult.products.find(e=>e.id==t)}}("https://dummyjson.com");o.onProductClick=function(t){let e=t.currentTarget.querySelector("form button");if(t.target!=e){let e=t.currentTarget.querySelector("form input");e.focus(),e.select()}},o.onPurchaseSubmit=function(t){t.preventDefault();let e=t.currentTarget.closest("article").dataset.productid,r=new FormData(t.currentTarget),s=o.findCurrentProductById(e);s&&o.cart.addProduct(e,s.title,Number(r.get("quantity"))??1,s.price),t.currentTarget.reset(),t.currentTarget.querySelector("input").blur(),t.currentTarget.querySelector("button").blur()},o.loadCategories(document.querySelector("#search-category")).catch(alert),o.getProducts().catch(alert),document.querySelector("#categoryform").addEventListener("submit",function(t){t.preventDefault();let e=new FormData(t.currentTarget);o.getProductsByCategory(e.get("category")??"").catch(alert),document.querySelector("#search-product").value="",t.currentTarget.querySelector("button").blur()}),document.querySelector("#searchform").addEventListener("submit",function(t){t.preventDefault();let e=new FormData(t.currentTarget);o.getProducts(e.get("product")??"").catch(alert),document.querySelector("#search-category").value="",t.currentTarget.querySelector("button").blur()}),document.querySelector("#pages-nav").addEventListener("submit",function(t){switch(t.preventDefault(),t.submitter.id){case"pages-nav-prev":o.getProductsPage("prev").catch(alert);break;case"pages-nav-next":o.getProductsPage("next").catch(alert);break;case"pages-nav-first":o.getProductsPage("first").catch(alert);break;case"pages-nav-last":o.getProductsPage("last").catch(alert);break;case"pages-nav-goto":let e=document.querySelector("#pages-goto-page");e.setAttribute("max",Math.ceil(o.currentResult.total/o.pageSize).toString()),e.value=Math.ceil(o.currentResult.skip/o.pageSize+1).toString(),e.select(),document.querySelector("#pages-goto-dialog").showModal()}t.submitter.blur()}),document.querySelector("#pages-goto-form").addEventListener("submit",function(t){t.preventDefault();let e=t.currentTarget.closest("dialog"),r=Number(document.querySelector("#pages-goto-page").value);!isNaN(r)&&r>0&&r<=Math.ceil(o.currentResult.total/o.pageSize)&&o.getProductsPage("page",r).catch(alert),e&&e.close()}),document.querySelector("#search-product").addEventListener("click",t=>t.currentTarget.select()),document.querySelector("#show-cart").addEventListener("click",function(t){o.cart.show(),t.currentTarget.blur()});
//# sourceMappingURL=index.2ff8fbd0.js.map
